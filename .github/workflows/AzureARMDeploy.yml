# on: [push]

# name: AzureARMDeploy

# jobs:

#   deploy:
#     runs-on: ubuntu-latest
#     steps:

#       - name: Login to Azure
#         uses: azure/login@v1
#         with:
#           creds: ${{ secrets.AZURE_CREDENTIALS }}

#       - name: Checkout source code
#         uses: actions/checkout@v2

      # - name: Deploy ARM template
      #   uses: azure/CLI@v1
      #   with: 
      #     inlinescript: |
      #       az deployment group create \
      #       --name StorageAccountDeployment \
      #       --resource-group azure-demo \
      #       --template-file arm-templates/storageaccount.json \
      #       --parameters storageAccountType=Standard_LRS


on: [push]

name: uploadmathhomework

jobs:

  deploy:
  runs-on: ubuntu-latest
  steps:

    - name: Login to azure
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: Checkout source code
      uses: actions/checkout@v2

    - job_1:
        name: Add 3 and 7
        runs-on: ubuntu-latest
        steps:
          - shell: bash
            run: |
              expr 3 + 7 > math-homework.txt
          - name: Upload math result for job 1
            uses: actions/upload-artifact@v3
            with:
              name: homework
              path: math-homework.txt

    - job_2:
        name: Multiply by 9
        needs: job_1
        runs-on: windows-latest
        steps:
          - name: Download math result for job 1
            uses: actions/download-artifact@v3
            with:
              name: homework
          - shell: bash
            run: |
              value=`cat math-homework.txt`
              expr $value \* 9 > math-homework.txt
          - name: Upload math result for job 2
            uses: actions/upload-artifact@v3
            with:
              name: homework
              path: math-homework.txt

    - job_3:
        name: Display results
        needs: job_2
        runs-on: macOS-latest
        steps:
          - name: Download math result for job 2
            uses: actions/download-artifact@v3
            with:
              name: homework
          - name: Print the final result
            shell: bash
            run: |
              value=`cat math-homework.txt`
              echo The result is $value

    - name: Upload to Blob Storage
        uses: actions/upload-artifact@v3
        with:
          account: azuredemostdsa
          destination: mathhomework